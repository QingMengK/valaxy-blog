---
title:
  - äº«å…ƒæ¨¡å¼
created: 2025-12-17
updated: 2025-12-17
type: ğŸ“˜ çŸ¥è¯†èŠ‚ç‚¹
tags:
---
> æ‘˜è¦ï¼š

## ä¸€ã€ä»€ä¹ˆæ˜¯äº«å…ƒæ¨¡å¼ï¼ˆFlyweightï¼‰

**ä¸€å¥è¯ç†è§£ï¼š**

> **äº«å…ƒæ¨¡å¼é€šè¿‡â€œå…±äº«â€æ¥å‡å°‘å¤§é‡ç›¸ä¼¼å¯¹è±¡çš„åˆ›å»ºï¼Œä»è€ŒèŠ‚çœå†…å­˜å’Œæé«˜æ€§èƒ½ã€‚**

å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š  
**æŠŠå¯ä»¥å…±äº«çš„éƒ¨åˆ†æŠ½å–å‡ºæ¥ï¼Œå¤šä¸ªå¯¹è±¡å…±ç”¨ï¼›ä¸å¯å…±äº«çš„éƒ¨åˆ†ç”±å¤–éƒ¨ä¼ å…¥ã€‚**

---

## äºŒã€ä¸€ä¸ªç”Ÿæ´»åŒ–çš„å°æ•…äº‹ï¼ˆèƒŒæ™¯ï¼‰

ä½ åœ¨åšä¸€ä¸ª **æ–‡å­—ç¼–è¾‘å™¨ / æ¸¸æˆ / åœ°å›¾ç³»ç»Ÿ**ï¼š

- å±å¹•ä¸Šæœ‰ **æˆåƒä¸Šä¸‡ä¸ªå­—ç¬¦ / æ ‘ / å­å¼¹**
    
- æ¯ä¸€ä¸ªå¯¹è±¡éƒ½ new ä¸€ä¸ªå®ä¾‹
    
- å†…å­˜æš´æ¶¨ï¼Œæ€§èƒ½ä¸‹é™ ğŸ˜±
    

ä½†ä½ å‘ç°ï¼š

- å­—ç¬¦ `A` çš„å½¢çŠ¶æ˜¯ä¸€æ ·çš„
    
- æ ‘çš„æ¨¡å‹æ˜¯ä¸€æ ·çš„
    
- å­å¼¹çš„å¤–è§‚æ˜¯ä¸€æ ·çš„
    

ğŸ‘‰ **çœŸæ­£ä¸åŒçš„åªæ˜¯ï¼šä½ç½®ã€é¢œè‰²ã€å¤§å°ã€çŠ¶æ€**

äºæ˜¯ä½ æƒ³åˆ°ï¼š

> â€œèƒ½ä¸èƒ½ **æ¨¡å‹åªåˆ›å»ºä¸€ä»½**ï¼Œå¤§å®¶å…±ç”¨ï¼Ÿâ€

è¿™ï¼Œå°±æ˜¯ **äº«å…ƒæ¨¡å¼**ã€‚

---

## ä¸‰ã€äº«å…ƒæ¨¡å¼çš„å…³é”®æ¦‚å¿µ

### 1ï¸âƒ£ å†…éƒ¨çŠ¶æ€ï¼ˆIntrinsic Stateï¼‰

- **å¯ä»¥å…±äº«**
    
- ä¸éšç¯å¢ƒå˜åŒ–
    
- å­˜åœ¨äº«å…ƒå¯¹è±¡å†…éƒ¨
    

ä¾‹å¦‚ï¼š

- å­—ç¬¦çš„å­—å½¢
    
- æ ‘çš„æ¨¡å‹
    
- å­å¼¹çš„ç½‘æ ¼
    

### 2ï¸âƒ£ å¤–éƒ¨çŠ¶æ€ï¼ˆExtrinsic Stateï¼‰

- **ä¸èƒ½å…±äº«**
    
- ç”±ä½¿ç”¨è€…ä¼ å…¥
    
- æ¯æ¬¡è°ƒç”¨æ—¶æä¾›
    

ä¾‹å¦‚ï¼š

- åæ ‡ä½ç½®
    
- é¢œè‰²
    
- æœå‘
    

---

## å››ã€ä¸ä½¿ç”¨äº«å…ƒæ¨¡å¼ï¼ˆé—®é¢˜ä»£ç ï¼‰

### âŒ æ¯æ¬¡éƒ½ new ä¸€ä¸ªå¯¹è±¡

`class Tree { public:     string model;     int x, y;      Tree(string m, int x, int y) : model(m), x(x), y(y) {} };`

`Tree* t1 = new Tree("BigTreeModel", 10, 20); Tree* t2 = new Tree("BigTreeModel", 30, 40); Tree* t3 = new Tree("BigTreeModel", 50, 60);`

â—é—®é¢˜ï¼š

- `BigTreeModel` è¢«é‡å¤åˆ›å»º
    
- æµªè´¹å†…å­˜
    

---

## äº”ã€ä½¿ç”¨äº«å…ƒæ¨¡å¼ï¼ˆæ ‡å‡†åšæ³•ï¼‰

---

### 1ï¸âƒ£ äº«å…ƒæ¥å£

`class Tree { public:     virtual void draw(int x, int y) = 0; };`

---

### 2ï¸âƒ£ å…·ä½“äº«å…ƒç±»ï¼ˆå…±äº«å¯¹è±¡ï¼‰

`class TreeModel : public Tree { private:     string model; // å†…éƒ¨çŠ¶æ€ï¼ˆå…±äº«ï¼‰  public:     TreeModel(string m) : model(m) {}      void draw(int x, int y) override {         cout << "Draw " << model << " at (" << x << ", " << y << ")" << endl;     } };`

---

### 3ï¸âƒ£ äº«å…ƒå·¥å‚ï¼ˆæ ¸å¿ƒï¼‰

`#include <map>  class TreeFactory { private:     static map<string, Tree*> pool;  public:     static Tree* getTree(string model) {         if (pool.find(model) == pool.end()) {             pool[model] = new TreeModel(model);         }         return pool[model];     } };  map<string, Tree*> TreeFactory::pool;`

---

### 4ï¸âƒ£ å®¢æˆ·ç«¯ä½¿ç”¨

`int main() {     Tree* tree1 = TreeFactory::getTree("BigTree");     tree1->draw(10, 20);      Tree* tree2 = TreeFactory::getTree("BigTree");     tree2->draw(30, 40);      return 0; }`

âœ”ï¸ **ä¸¤ä¸ªæ ‘å¯¹è±¡å…±äº«åŒä¸€ä¸ªæ¨¡å‹å®ä¾‹**

---

## å…­ã€C# é£æ ¼ç¤ºä¾‹ï¼ˆæ›´ç›´è§‚ï¼‰

`interface Character {     void Display(int size); }`

`class CharacterA : Character {     private char symbol = 'A';      public void Display(int size) {         Console.WriteLine($"Character {symbol}, size {size}");     } }`

`class CharacterFactory {     private static Dictionary<char, Character> pool = new();      public static Character GetCharacter(char c) {         if (!pool.ContainsKey(c)) {             pool[c] = new CharacterA();         }         return pool[c];     } }`

`Character a1 = CharacterFactory.GetCharacter('A'); a1.Display(12);  Character a2 = CharacterFactory.GetCharacter('A'); a2.Display(20);`

---

## ä¸ƒã€äº«å…ƒæ¨¡å¼çš„ç»“æ„æ€»ç»“

`Client   |   v FlyweightFactory â€”â€”> Flyweightï¼ˆå…±äº«å¯¹è±¡ï¼‰                           |                     ConcreteFlyweight`

---

## å…«ã€ä»€ä¹ˆæ—¶å€™è¯¥ç”¨äº«å…ƒæ¨¡å¼ï¼Ÿ

âœ… é€‚åˆï¼š

- å¤§é‡ç›¸ä¼¼å¯¹è±¡
    
- å¯¹è±¡åˆ›å»ºæˆæœ¬é«˜
    
- å†…å­˜æ•æ„Ÿåœºæ™¯
    

âŒ ä¸é€‚åˆï¼š

- å¯¹è±¡å·®å¼‚å¾ˆå¤§
    
- çŠ¶æ€å‡ ä¹æ— æ³•å…±äº«